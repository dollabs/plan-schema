#!/bin/sh
# plan-schema
#
# Copyright Â© 2016 Dynamic Object Language Labs Inc.
#
# This software is licensed under the terms of the
# Apache License, Version 2.0 which can be found in
# the file LICENSE at the root of this distribution.

program=$(basename $0)
dir=$(dirname $0)
export PLAN_SCHEMA_CWD="$(pwd -P)"
cd "$dir"
cd ..
top="."

verbose=0

# functions ------------------------------------------
log() {
  # do NOT log now
  # echo $* >> "$logfile"
  echo $*
}

vlog() {
    [ $verbose -eq 0 ] || log "$@"
}

vvlog() {
    [ $verbose -lt 2 ] || log "$@"
}

err() {
  # as log only echos we do not need to repeat this here
  # log "${program}: $*"
  echo >&2 "${program}: $*"
}

# main program -----------------------------------------------
case "$1" in
    (-v|-vv|-vvv|-vvvv|--verbose)
        verbose=$(( $verbose + 1 ))
        ;;
esac

# vlog "-- starting $program at $(date) --"

# ensure plan-schema does not use PAGER to guess we are in the repl
unset PAGER

vlog "-- starting $program at $(date) --"
args="$@"
vlog boot run -a "\"$args\""
boot run -a "$args"
